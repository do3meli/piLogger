#!/bin/bash 

this_dir=$(cd `dirname $0`; pwd)
. $this_dir/functions

#--------------------------------
# usage()
#--------------------------------
usage(){
cat<<EOT

Usage:

  `basename $0` alias|/path/to/device
  `basename $0` deviceAddress temperature

EOT
}

#================================
# MAIN
#================================
[ -z "$1" ] && { usage ; exit 1 ; }

action=none
[ -n "$1" ] && action=readSensor
[ -n "$2" ] && action=noreadSensor

#--- check the device
case $action in
  readSensor)
    [ -d $1 ] &&   { curDevicePath=$1 ; curDevice=$(basename $1) ; }
    [ ! -d $1 ] && { curDevicePath=$(getDevicePathByAlias $1) ; curDevice=$(getDeviceByAlias $1) ; }
    [ -z "$curDevice" ] && errorExit "There is no device named $1"
    #--- get the temperature
    curTemperature=$(getTemperatureByDevicePath $curDevicePath)
    [ -z "$curTemperature" ] && errorExit "Could not read temperature from $curDevice"
    ;;
  noreadSensor)
    #--- no existing device (external device) -> then a temperature has to be passed as well
    curDevice=$1
    curTemperature=$2
    ;;
  *)
    errorExit "No action"
    ;;
esac

logIt "  - Logging data for device $curDevice, $curTemperature C"

#--- at this point, there HAS to be a device, and ther has to be a temperature
logTemperature $curDevice $curTemperature
