#!/bin/bash

this_dir=$(cd `dirname $0`; pwd)
this_script=$(basename $0)

. $this_dir/functions
. $this_dir/functions-sqlite3

#--------------------------------
# usage()
#--------------------------------
usage(){
cat<<EOT

Usage:

  $this_script --db                 - Get device ID's from the database 
  $this_script capture.NAME.conf    - Get device ID's from a config file

EOT
}

#================================
# MAIN
#================================
[ -z "$1" ] && { usage ; exit 1 ; }

  case $1 in
    --db)
      aliases=$(dbGetAllLocalDeviceIds)
      ;;
    *)
      curConfigFile=$1
      [ ! -f $curConfigFile ] && errorExit "Could not find config file: $curConfigFile"

      aliases="$(cat $curConfigFile | grep -v "^#")"
      ;;
  esac

  [ -z "$parallelProcessing" ] && parallelProcessing=1
  echo $aliases | xargs -n 1 -P${parallelProcessing}  $this_dir/logTemperature 
