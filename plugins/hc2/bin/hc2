#!/usr/bin/php5
<?php

#=========================================
# Functions
#=========================================

function getSensorData($id = ""){
  $curl = curl_init();
  if ($id == "") {
    curl_setopt($curl, CURLOPT_URL, "http://192.168.3.10/api/devices");
  } else {
    curl_setopt($curl, CURLOPT_URL, "http://192.168.3.10/api/devices/{$id}");
  }

  curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
  curl_setopt($curl, CURLOPT_HTTPAUTH, CURLAUTH_ANY);
  curl_setopt($curl, CURLOPT_USERPWD, "admin:Br09k13");
  $result = curl_exec($curl);
  curl_close($curl);

  $result_parsed = json_decode($result);

  return $result_parsed;
}

function getTemperature($id){
  $res = getSensorData($id);
  return $res->properties->value;
}

#=========================================
# MAIN
#=========================================

  if (! isset( $argv[1] ) ) { exit(1); }
  $curTemperature = getTemperature($argv[1]);
  print "{$curTemperature}\n";

?>
